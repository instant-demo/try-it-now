{
	# Enable admin API for dynamic route management
	admin :2019

	# Production: automatic HTTPS via Let's Encrypt
	email admin@migration-pro.com

	# On-demand TLS for dynamic demo subdomains
	# Individual certs are issued per subdomain (no wildcard needed)
	on_demand_tls {
		# Allow any subdomain of demo.migration-pro.com
		# The app manages which routes are active via admin API
	}
}

# Main API endpoint
demo.migration-pro.com {
	# Health check
	handle /health {
		respond "OK" 200
	}

	# API routes - proxy to Go application
	handle /api/* {
		reverse_proxy localhost:8080
	}

	handle /metrics {
		reverse_proxy localhost:8080
	}

	# Default response
	handle {
		respond "Try It Now - Demo Provisioning System" 200
	}
}

# Dynamic demo subdomains - routes added via admin API
# This is a catch-all that uses on-demand TLS
*.demo.migration-pro.com {
	tls {
		on_demand
	}

	# Fallback for subdomains without a specific route
	respond "Demo not found or expired" 404
}
